## Context
- 需要在 Windows/macOS/Linux 上提供统一的权限提示与提升流程
- 多处长耗时任务（rustup/工具链安装、缓存扫描、备份预览）当前为同步调用，易导致界面卡顿或无响应
- 新需求要求所有平台一致：启动即请求管理员权限（可取消），并引入毛玻璃动态 Loading 反馈

## Goals / Non-Goals
- Goals:
  - 启动时明确管理员权限状态并引导提升
  - 系统级操作可靠、可恢复，界面始终可交互
  - 长耗时操作提供进度/状态反馈并避免主线程阻塞
- Non-Goals:
  - 不改动 Rustup/Cargo 的业务行为或镜像源协议
  - 不引入复杂的后台作业框架或遥测系统

## Decisions
- Decision: 启动阶段获取管理员状态并缓存；所有平台非管理员时显示阻断提示与“请求管理员权限”按钮。
- Decision: Windows 使用 UAC 提权重启（`runas`/`ShellExecute`）；当前实例在成功触发后退出。
- Decision: macOS 使用系统授权（`osascript` with administrator privileges）重启；Linux 优先 `pkexec`，不可用时提示安装或回退为手动 sudo 命令。
- Decision: 用户取消提权则进入普通模式，系统级功能继续受限并持续提示权限需求。
- Decision: 所有长耗时操作在后端使用阻塞线程/异步任务执行，并通过统一状态反馈；前端在对应区域展示毛玻璃 Loading 覆盖层。
- Decision: Loading 采用模块级覆盖优先（卡片/区域级），仅在全局性操作（如即将重启）时显示全局遮罩，避免影响整体操作。
- Decision: 备份预览改为按需加载，预加载仅在空闲时分批/限流执行，并支持取消。
- Decision: 缓存大小统计改为后台计算，可先返回路径或历史值，再异步更新。

## Alternatives considered
- Windows 通过应用清单强制管理员启动
  - 缺点：无法提供“是否提权”的显式操作入口，且影响普通使用场景
- 仅在用户触发系统级操作时再弹权限提示
  - 缺点：失败路径更复杂，用户仍会遇到“点了无反应”
- 保留备份预览全量预载
  - 缺点：备份数多时明显卡顿

## Risks / Trade-offs
- 启动即请求提权会增加一次交互成本
  - 缓解：允许取消并进入普通模式，提示系统级功能受限
- 提权重启可能丢失未保存的临时状态
  - 缓解：重启前提示用户，确保关键状态可恢复
- Linux `pkexec` 依赖系统组件
  - 缓解：缺失时提供可复制的 sudo 命令与安装指引
- 异步化与 Loading 覆盖层引入更多状态管理
  - 缓解：封装统一的操作状态模型与覆盖层组件

## Migration Plan
1. 新增跨平台提权重启命令（后端）与权限检测
2. 前端启动时拉取权限状态并呈现阻断提示（所有平台一致）
3. 增加毛玻璃 Loading 覆盖层组件并接入长耗时任务
4. 分阶段异步化长耗时任务，逐一验证
5. 手动验证跨平台提权流程与失败路径

## Open Questions
- 需要支持“记住我不再提示”的开关吗？
